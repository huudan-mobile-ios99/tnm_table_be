"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.decodeScreenAdjustInfo = void 0;
const ScreenAdjustParams_1 = require("@novastar/native/ScreenAdjustParams");
const common_1 = require("@novastar/native/common");
const typed_struct_1 = __importDefault(require("typed-struct"));
const ScreenAdjustParam = new typed_struct_1.default('ScreenAdjustParam')
    .UInt8('ScreenXZoomType')
    .UInt8('ScreenXScale')
    .UInt8('ScreenYZoomType')
    .UInt8('ScreenYScale')
    .UInt8('VirtualMap')
    .String('ScreenName', 20)
    .UInt8('ThreeD')
    .back(0)
    .seek(40)
    .compile();
const ScreenAdjustParamOld = new typed_struct_1.default('ScreenAdjustParamOld')
    .UInt8('ScreenXZoomType')
    .UInt8('ScreenXScale')
    .UInt8('ScreenYZoomType')
    .UInt8('ScreenYScale')
    .UInt8('VirtualMap')
    .String('ScreenName', 20)
    .UInt8('ThreeD')
    .back(0)
    .seek(41)
    .compile();
const ScreenAdjustInfo = new typed_struct_1.default('ScreenAdjustInfo')
    .UInt16LE('version')
    .back(0)
    .seek(132)
    .UInt8('count')
    .StructArray('oldParams', ScreenAdjustParamOld)
    .back()
    .StructArray('params', ScreenAdjustParam)
    .compile();
// eslint-disable-next-line import/prefer-default-export
function decodeScreenAdjustInfo(buffer) {
    const info = new ScreenAdjustInfo(buffer).toJSON();
    const { version, count } = info;
    const paramSize = version <= 1001 ? ScreenAdjustParamOld.baseSize : ScreenAdjustParam.baseSize;
    const length = count * paramSize + ScreenAdjustInfo.baseSize;
    if (buffer.length < length)
        throw new Error('Invalid adjust length');
    const params = version <= 1001 ? info.oldParams : info.params;
    if (params.length !== count)
        throw new TypeError('Wrong number of adjust parameters');
    return params.map(param => (0, common_1.makeStruct)(ScreenAdjustParams_1.ScreenAdjustParams, param));
}
exports.decodeScreenAdjustInfo = decodeScreenAdjustInfo;
//# sourceMappingURL=ScreenAdjustInfo.js.map